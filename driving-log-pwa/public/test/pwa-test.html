<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWAæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ - é‹è»¢æ—¥å ±PWA</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2196F3;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ccc;
            display: inline-block;
        }
        .test-status.pass {
            background: #4CAF50;
        }
        .test-status.fail {
            background: #f44336;
        }
        .test-status.warning {
            background: #FF9800;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #1976D2;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .info-item {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
        }
        .info-label {
            font-weight: bold;
            color: #666;
            font-size: 12px;
        }
        .info-value {
            color: #333;
            font-size: 14px;
        }
        .install-prompt {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        .install-prompt button {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 6px;
            font-size: 16px;
        }
        .install-prompt button:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ PWAæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
        
        <!-- PWAåŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>
                <span class="test-status" id="basic-status"></span>
                PWAåŸºæœ¬æ©Ÿèƒ½
            </h2>
            
            <div class="test-item">
                <span>Service Workerå¯¾å¿œ</span>
                <span id="sw-support">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>Service Workerç™»éŒ²çŠ¶æ…‹</span>
                <span id="sw-registration">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>Manifestãƒ•ã‚¡ã‚¤ãƒ«</span>
                <span id="manifest-check">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>HTTPS/Localhost</span>
                <span id="https-check">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½</span>
                <button id="test-install" onclick="testInstallability()">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½æ€§ã‚’ãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>

        <!-- ã‚¢ã‚¤ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>
                <span class="test-status" id="icons-status"></span>
                ã‚¢ã‚¤ã‚³ãƒ³ãƒ»ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«
            </h2>
            
            <div class="test-item">
                <span>ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ (192x192)</span>
                <span id="icon-192">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ (512x512)</span>
                <span id="icon-512">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>Apple Touch Icon</span>
                <span id="apple-icon">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>Favicon</span>
                <span id="favicon">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼</span>
                <span id="theme-color">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
        </div>

        <!-- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>
                <span class="test-status" id="shortcuts-status"></span>
                ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆæ©Ÿèƒ½
            </h2>
            
            <div class="test-item">
                <span>åŸºæœ¬ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</span>
                <span id="basic-shortcuts">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³</span>
                <span id="shortcut-icons">ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
            
            <div class="test-item">
                <span>å‹•çš„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</span>
                <button onclick="testDynamicShortcuts()">å‹•çš„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>

        <!-- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>
                <span class="test-status" id="offline-status"></span>
                ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½
            </h2>
            
            <div class="test-item">
                <span>ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½</span>
                <button onclick="testCaching()">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒ†ã‚¹ãƒˆ</button>
            </div>
            
            <div class="test-item">
                <span>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è¡¨ç¤º</span>
                <button onclick="testOfflineMode()">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆ</button>
            </div>
            
            <div class="test-item">
                <span>åŒæœŸæ©Ÿèƒ½</span>
                <button onclick="testSync()">åŒæœŸæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ</button>
            </div>
        </div>

        <!-- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ -->
        <div id="install-prompt" class="install-prompt" style="display: none;">
            <h3>ğŸ“± ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã‹ï¼Ÿ</h3>
            <p>é‹è»¢æ—¥å ±PWAã‚’ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ç”¨ã§ãã¾ã™ã€‚</p>
            <button onclick="installApp()">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
            <button onclick="dismissInstall()">å¾Œã§</button>
        </div>

        <!-- ç’°å¢ƒæƒ…å ± -->
        <div class="test-section">
            <h2>ç’°å¢ƒæƒ…å ±</h2>
            <div class="info-grid" id="environment-info">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ãƒ†ã‚¹ãƒˆãƒ­ã‚° -->
        <div class="test-section">
            <h2>ãƒ†ã‚¹ãƒˆãƒ­ã‚°</h2>
            <div class="log" id="test-log"></div>
            <button onclick="clearLog()" style="margin-top: 10px;">ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢</button>
            <button onclick="downloadLog()">ãƒ­ã‚°ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
        </div>
    </div>

    <script>
        let deferredPrompt;
        let testResults = {
            basic: [],
            icons: [],
            shortcuts: [],
            offline: []
        };

        // ãƒ­ã‚°æ©Ÿèƒ½
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('test-log');
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`PWA Test: ${message}`);
        }

        function clearLog() {
            document.getElementById('test-log').textContent = '';
        }

        function downloadLog() {
            const logContent = document.getElementById('test-log').textContent;
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pwa-test-log-${new Date().toISOString().slice(0,19)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // PWAåŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        async function testBasicPWAFeatures() {
            log('PWAåŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™');

            // Service Workerå¯¾å¿œãƒã‚§ãƒƒã‚¯
            const swSupport = 'serviceWorker' in navigator;
            document.getElementById('sw-support').textContent = swSupport ? 'âœ… å¯¾å¿œ' : 'âŒ éå¯¾å¿œ';
            testResults.basic.push({ test: 'SW Support', result: swSupport });
            log(`Service Workerå¯¾å¿œ: ${swSupport ? 'å¯¾å¿œ' : 'éå¯¾å¿œ'}`, swSupport ? 'success' : 'error');

            // Service Workerç™»éŒ²çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
            if (swSupport) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    const swRegistered = registration !== undefined;
                    document.getElementById('sw-registration').textContent = swRegistered ? 'âœ… ç™»éŒ²æ¸ˆã¿' : 'âš ï¸ æœªç™»éŒ²';
                    testResults.basic.push({ test: 'SW Registration', result: swRegistered });
                    log(`Service Workerç™»éŒ²: ${swRegistered ? 'ç™»éŒ²æ¸ˆã¿' : 'æœªç™»éŒ²'}`, swRegistered ? 'success' : 'error');
                    
                    if (swRegistered) {
                        log(`Service WorkerçŠ¶æ…‹: ${registration.active ? 'active' : 'inactive'}`);
                        log(`Service Workerã‚¹ã‚³ãƒ¼ãƒ—: ${registration.scope}`);
                    }
                } catch (error) {
                    document.getElementById('sw-registration').textContent = 'âŒ ã‚¨ãƒ©ãƒ¼';
                    log(`Service Workerç™»éŒ²ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }

            // Manifestãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
            try {
                const response = await fetch('/manifest.json');
                const manifestExists = response.ok;
                if (manifestExists) {
                    const manifest = await response.json();
                    document.getElementById('manifest-check').textContent = 'âœ… æ­£å¸¸';
                    testResults.basic.push({ test: 'Manifest', result: true });
                    log('Manifestãƒ•ã‚¡ã‚¤ãƒ«: æ­£å¸¸ã«èª­ã¿è¾¼ã‚ã¾ã—ãŸ', 'success');
                    log(`ã‚¢ãƒ—ãƒªå: ${manifest.name}`);
                    log(`ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆæ•°: ${manifest.shortcuts?.length || 0}`);
                } else {
                    document.getElementById('manifest-check').textContent = 'âŒ ã‚¨ãƒ©ãƒ¼';
                    testResults.basic.push({ test: 'Manifest', result: false });
                    log('Manifestãƒ•ã‚¡ã‚¤ãƒ«: èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼', 'error');
                }
            } catch (error) {
                document.getElementById('manifest-check').textContent = 'âŒ ã‚¨ãƒ©ãƒ¼';
                log(`Manifestãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }

            // HTTPS/Localhostãƒã‚§ãƒƒã‚¯
            const isSecure = location.protocol === 'https:' || location.hostname === 'localhost';
            document.getElementById('https-check').textContent = isSecure ? 'âœ… ã‚»ã‚­ãƒ¥ã‚¢' : 'âŒ éã‚»ã‚­ãƒ¥ã‚¢';
            testResults.basic.push({ test: 'HTTPS', result: isSecure });
            log(`æ¥ç¶š: ${isSecure ? 'ã‚»ã‚­ãƒ¥ã‚¢ (HTTPS/localhost)' : 'éã‚»ã‚­ãƒ¥ã‚¢'}`, isSecure ? 'success' : 'error');

            updateSectionStatus('basic', testResults.basic.every(t => t.result));
        }

        // ã‚¢ã‚¤ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ
        async function testIcons() {
            log('ã‚¢ã‚¤ã‚³ãƒ³ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™');

            const iconTests = [
                { id: 'icon-192', path: '/icons/icon-192x192.svg', name: '192x192ã‚¢ã‚¤ã‚³ãƒ³' },
                { id: 'icon-512', path: '/icons/icon-512x512.svg', name: '512x512ã‚¢ã‚¤ã‚³ãƒ³' },
                { id: 'apple-icon', path: '/icons/apple-touch-icon.svg', name: 'Apple Touch Icon' },
                { id: 'favicon', path: '/icons/favicon.svg', name: 'Favicon' }
            ];

            for (const icon of iconTests) {
                try {
                    const response = await fetch(icon.path);
                    const exists = response.ok;
                    document.getElementById(icon.id).textContent = exists ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨';
                    testResults.icons.push({ test: icon.name, result: exists });
                    log(`${icon.name}: ${exists ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`, exists ? 'success' : 'error');
                } catch (error) {
                    document.getElementById(icon.id).textContent = 'âŒ ã‚¨ãƒ©ãƒ¼';
                    log(`${icon.name}ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }

            // ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
            const themeColorMeta = document.querySelector('meta[name="theme-color"]');
            const hasThemeColor = themeColorMeta !== null;
            document.getElementById('theme-color').textContent = hasThemeColor ? 
                `âœ… ${themeColorMeta.content}` : 'âŒ æœªè¨­å®š';
            testResults.icons.push({ test: 'Theme Color', result: hasThemeColor });
            log(`ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼: ${hasThemeColor ? themeColorMeta.content : 'æœªè¨­å®š'}`, hasThemeColor ? 'success' : 'error');

            updateSectionStatus('icons', testResults.icons.every(t => t.result));
        }

        // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
        async function testShortcuts() {
            log('ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™');

            try {
                const response = await fetch('/manifest.json');
                if (response.ok) {
                    const manifest = await response.json();
                    const shortcutsCount = manifest.shortcuts?.length || 0;
                    document.getElementById('basic-shortcuts').textContent = 
                        shortcutsCount > 0 ? `âœ… ${shortcutsCount}å€‹` : 'âŒ æœªè¨­å®š';
                    testResults.shortcuts.push({ test: 'Basic Shortcuts', result: shortcutsCount > 0 });
                    log(`åŸºæœ¬ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: ${shortcutsCount}å€‹`, shortcutsCount > 0 ? 'success' : 'error');

                    // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³ãƒã‚§ãƒƒã‚¯
                    if (shortcutsCount > 0) {
                        let iconCount = 0;
                        for (const shortcut of manifest.shortcuts) {
                            if (shortcut.icons && shortcut.icons.length > 0) {
                                iconCount++;
                            }
                        }
                        document.getElementById('shortcut-icons').textContent = 
                            iconCount === shortcutsCount ? 'âœ… å®Œå‚™' : `âš ï¸ ${iconCount}/${shortcutsCount}`;
                        testResults.shortcuts.push({ test: 'Shortcut Icons', result: iconCount === shortcutsCount });
                        log(`ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³: ${iconCount}/${shortcutsCount}`, iconCount === shortcutsCount ? 'success' : 'error');
                    }
                }
            } catch (error) {
                log(`ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }

            updateSectionStatus('shortcuts', testResults.shortcuts.every(t => t.result));
        }

        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½æ€§ãƒ†ã‚¹ãƒˆ
        function testInstallability() {
            log('ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½æ€§ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™');
            
            if (deferredPrompt) {
                log('ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒåˆ©ç”¨å¯èƒ½ã§ã™', 'success');
                document.getElementById('install-prompt').style.display = 'block';
                document.getElementById('test-install').textContent = 'âœ… ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½';
            } else {
                log('ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯åˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                log('æ³¨æ„: Chromeã§ã¯30ç§’ä»¥ä¸Šã®æ“ä½œå¾Œã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™', 'info');
                document.getElementById('test-install').textContent = 'âŒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸å¯ (30ç§’å¾…æ©Ÿå¾Œã«å†è©¦è¡Œ)';
                
                // 30ç§’å¾Œã«è‡ªå‹•å†ãƒ†ã‚¹ãƒˆ
                setTimeout(() => {
                    if (deferredPrompt) {
                        log('30ç§’çµŒéå¾Œ: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸ!', 'success');
                        document.getElementById('install-prompt').style.display = 'block';
                        document.getElementById('test-install').textContent = 'âœ… ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½';
                    } else {
                        log('30ç§’çµŒéå¾Œã‚‚ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯åˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                    }
                }, 30000);
            }
        }

        // å‹•çš„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
        async function testDynamicShortcuts() {
            log('å‹•çš„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™');
            
            try {
                const response = await fetch('/shortcuts/shortcuts-config.json');
                if (response.ok) {
                    const config = await response.json();
                    const dynamicCount = config.dynamic_shortcuts?.length || 0;
                    const contextualCount = config.contextual_shortcuts?.length || 0;
                    log(`å‹•çš„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­å®š: ${dynamicCount}å€‹`, dynamicCount > 0 ? 'success' : 'info');
                    log(`ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­å®š: ${contextualCount}å€‹`, contextualCount > 0 ? 'success' : 'info');
                } else {
                    log('ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                }
            } catch (error) {
                log(`å‹•çš„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ
        async function testCaching() {
            log('ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™');
            
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    log(`ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: ${cacheNames.length}å€‹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå­˜åœ¨`, 'success');
                    
                    for (const cacheName of cacheNames) {
                        const cache = await caches.open(cacheName);
                        const keys = await cache.keys();
                        log(`${cacheName}: ${keys.length}å€‹ã®ã‚¢ã‚¤ãƒ†ãƒ `);
                    }
                    
                    testResults.offline.push({ test: 'Cache API', result: true });
                } catch (error) {
                    log(`ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    testResults.offline.push({ test: 'Cache API', result: false });
                }
            } else {
                log('Cache APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                testResults.offline.push({ test: 'Cache API', result: false });
            }
        }

        // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
        function testOfflineMode() {
            log('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™');
            
            const isOnline = navigator.onLine;
            log(`ç¾åœ¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹: ${isOnline ? 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³' : 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³'}`, 'info');
            
            // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            window.addEventListener('offline', () => {
                log('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’æ¤œå‡ºã—ã¾ã—ãŸ', 'info');
            });
            
            window.addEventListener('online', () => {
                log('ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã«å¾©å¸°ã—ã¾ã—ãŸ', 'success');
            });
            
            log('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã®ç›£è¦–ã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'success');
        }

        // åŒæœŸæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        function testSync() {
            log('åŒæœŸæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™');
            
            if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
                log('Background Sync APIãŒåˆ©ç”¨å¯èƒ½ã§ã™', 'success');
                testResults.offline.push({ test: 'Background Sync', result: true });
            } else {
                log('Background Sync APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                testResults.offline.push({ test: 'Background Sync', result: false });
            }
            
            // Service Workerã«åŒæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    if (registration.active) {
                        registration.active.postMessage({
                            type: 'TEST_SYNC',
                            data: { timestamp: Date.now() }
                        });
                        log('Service Workerã«åŒæœŸãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸ', 'success');
                    }
                });
            }

            updateSectionStatus('offline', testResults.offline.every(t => t.result));
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹æ›´æ–°
        function updateSectionStatus(section, passed) {
            const statusElement = document.getElementById(`${section}-status`);
            if (passed) {
                statusElement.className = 'test-status pass';
            } else {
                statusElement.className = 'test-status fail';
            }
        }

        // ç’°å¢ƒæƒ…å ±è¡¨ç¤º
        function displayEnvironmentInfo() {
            const info = {
                'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ': navigator.userAgent,
                'ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ': navigator.platform,
                'ãƒ—ãƒ­ãƒˆã‚³ãƒ«': location.protocol,
                'ãƒ›ã‚¹ãƒˆ': location.host,
                'Service Workerå¯¾å¿œ': 'serviceWorker' in navigator ? 'ã¯ã„' : 'ã„ã„ãˆ',
                'Cache APIå¯¾å¿œ': 'caches' in window ? 'ã¯ã„' : 'ã„ã„ãˆ',
                'IndexedDBå¯¾å¿œ': 'indexedDB' in window ? 'ã¯ã„' : 'ã„ã„ãˆ',
                'Push APIå¯¾å¿œ': 'PushManager' in window ? 'ã¯ã„' : 'ã„ã„ãˆ',
                'Notification APIå¯¾å¿œ': 'Notification' in window ? 'ã¯ã„' : 'ã„ã„ãˆ',
                'Geolocation APIå¯¾å¿œ': 'geolocation' in navigator ? 'ã¯ã„' : 'ã„ã„ãˆ'
            };

            const grid = document.getElementById('environment-info');
            grid.innerHTML = '';

            for (const [label, value] of Object.entries(info)) {
                const item = document.createElement('div');
                item.className = 'info-item';
                item.innerHTML = `
                    <div class="info-label">${label}</div>
                    <div class="info-value">${value}</div>
                `;
                grid.appendChild(item);
            }
        }

        // ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                log(`ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çµæœ: ${outcome}`, outcome === 'accepted' ? 'success' : 'info');
                deferredPrompt = null;
                document.getElementById('install-prompt').style.display = 'none';
            }
        }

        function dismissInstall() {
            document.getElementById('install-prompt').style.display = 'none';
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            log('ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸ', 'success');
        });

        window.addEventListener('appinstalled', () => {
            log('ã‚¢ãƒ—ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸ!', 'success');
            deferredPrompt = null;
        });

        // Service Workerç™»éŒ²
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    log('Service Workerç™»éŒ²æˆåŠŸ: ' + registration.scope, 'success');
                    return registration;
                } catch (error) {
                    log('Service Workerç™»éŒ²å¤±æ•—: ' + error.message, 'error');
                    return null;
                }
            } else {
                log('Service Workerã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return null;
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            log('PWAãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™');
            
            // Service Workerç™»éŒ²
            await registerServiceWorker();
            
            displayEnvironmentInfo();
            
            await testBasicPWAFeatures();
            await testIcons();
            await testShortcuts();
            
            log('PWAãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ');
        });
    </script>
</body>
</html>