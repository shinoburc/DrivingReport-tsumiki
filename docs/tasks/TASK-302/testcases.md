# TASK-302: 履歴管理機能実装 - テストケース設計

## テストケース一覧

### 1. 一覧表示機能テスト

#### TC-001: 基本一覧表示
- **目的**: 運転記録一覧を正常に表示できることを確認
- **入力**: getHistoryList()
- **期待結果**: 
  - 最新順で記録が表示される
  - 各記録の要約情報が含まれる
  - totalCountが正確

#### TC-002: 空状態の表示
- **目的**: 記録がない場合の表示確認
- **入力**: データなしでgetHistoryList()
- **期待結果**: 
  - 空の配列が返される
  - totalCount = 0
  - hasMore = false

#### TC-003: ページネーション
- **目的**: ページ分割表示の確認
- **入力**: getHistoryList({ pagination: { page: 1, size: 10 } })
- **期待結果**: 
  - 指定サイズのデータが返される
  - hasMoreが適切に設定される

### 2. 検索機能テスト

#### TC-004: フリーテキスト検索
- **目的**: 文字列での検索機能確認
- **入力**: searchHistory({ text: '東京' })
- **期待結果**: 
  - '東京'を含む記録が返される
  - 地点名・メモ・目的から検索される

#### TC-005: 部分一致検索
- **目的**: 部分一致での検索確認
- **入力**: searchHistory({ text: '駅' })
- **期待結果**: 
  - '新宿駅'、'東京駅'などが検索される

#### TC-006: あいまい検索
- **目的**: 曖昧な文字列での検索
- **入力**: searchHistory({ text: 'とうきょう', fuzzy: true })
- **期待結果**: 
  - '東京'関連の記録が検索される

#### TC-007: 検索対象フィールド指定
- **目的**: 特定フィールドのみ検索
- **入力**: searchHistory({ text: '会議', fields: ['memo'] })
- **期待結果**: 
  - メモフィールドのみから検索される

#### TC-008: 検索結果なし
- **目的**: 該当なしの場合の処理
- **入力**: searchHistory({ text: '存在しない文字列' })
- **期待結果**: 
  - 空の結果が返される
  - エラーにならない

### 3. フィルタリング機能テスト

#### TC-009: 日付範囲フィルタ
- **目的**: 期間指定でのフィルタリング
- **入力**: filterHistory({ dateRange: { startDate: '2024-01-01', endDate: '2024-01-31' } })
- **期待結果**: 
  - 指定期間内の記録のみ返される

#### TC-010: ステータスフィルタ
- **目的**: ステータスでのフィルタリング
- **入力**: filterHistory({ status: [DrivingLogStatus.COMPLETED] })
- **期待結果**: 
  - 完了済み記録のみ返される

#### TC-011: 距離範囲フィルタ
- **目的**: 走行距離での絞り込み
- **入力**: filterHistory({ distanceRange: { min: 10, max: 50 } })
- **期待結果**: 
  - 10-50km の記録のみ返される

#### TC-012: 時間範囲フィルタ
- **目的**: 所要時間での絞り込み
- **入力**: filterHistory({ durationRange: { min: 60 } })
- **期待結果**: 
  - 1時間以上の記録のみ返される

#### TC-013: 場所フィルタ
- **目的**: 地点での絞り込み
- **入力**: filterHistory({ locations: ['東京駅'] })
- **期待結果**: 
  - 東京駅を含む記録のみ返される

#### TC-014: 複合フィルタ
- **目的**: 複数条件の組み合わせ
- **入力**: 日付 + ステータス + 距離の複合フィルタ
- **期待結果**: 
  - すべての条件を満たす記録のみ返される

### 4. ソート機能テスト

#### TC-015: 日付ソート（降順）
- **目的**: 日付での降順ソート
- **入力**: sortHistory({ field: 'date', order: 'desc' })
- **期待結果**: 
  - 最新日付から順に並ぶ

#### TC-016: 日付ソート（昇順）
- **目的**: 日付での昇順ソート
- **入力**: sortHistory({ field: 'date', order: 'asc' })
- **期待結果**: 
  - 古い日付から順に並ぶ

#### TC-017: 距離ソート
- **目的**: 走行距離でのソート
- **入力**: sortHistory({ field: 'distance', order: 'desc' })
- **期待結果**: 
  - 距離の長い順に並ぶ

#### TC-018: 時間ソート
- **目的**: 所要時間でのソート
- **入力**: sortHistory({ field: 'duration', order: 'desc' })
- **期待結果**: 
  - 時間の長い順に並ぶ

### 5. ページネーション・仮想スクロールテスト

#### TC-019: ページ取得
- **目的**: 指定ページの取得
- **入力**: getHistoryPage(2, 20)
- **期待結果**: 
  - 2ページ目の20件が返される
  - ページ情報が正確

#### TC-020: 追加読み込み
- **目的**: 無限スクロール用の追加読み込み
- **入力**: loadMoreHistory(cursor)
- **期待結果**: 
  - カーソル以降のデータが返される
  - 重複がない

#### TC-021: 最後のページ
- **目的**: 最終ページの処理
- **入力**: 最後のページを取得
- **期待結果**: 
  - hasMore = false
  - nextCursor = null

### 6. 詳細表示テスト

#### TC-022: 詳細取得
- **目的**: 個別記録の詳細取得
- **入力**: getHistoryDetail(logId)
- **期待結果**: 
  - 完全な記録情報が返される
  - 経由地点も含まれる

#### TC-023: 存在しない記録
- **目的**: 無効なIDでの詳細取得
- **入力**: getHistoryDetail('invalid-id')
- **期待結果**: 
  - nullまたは適切なエラー

### 7. 設定管理テスト

#### TC-024: 表示設定の保存
- **目的**: ユーザー設定の永続化
- **入力**: saveViewSettings({ defaultSort: { field: 'date', order: 'desc' } })
- **期待結果**: 
  - 設定が保存される

#### TC-025: 表示設定の読み込み
- **目的**: 保存された設定の復元
- **入力**: loadViewSettings()
- **期待結果**: 
  - 以前の設定が復元される

### 8. 検索履歴管理テスト

#### TC-026: 検索履歴の保存
- **目的**: 検索クエリの履歴保存
- **入力**: saveSearchHistory('東京駅')
- **期待結果**: 
  - 検索履歴に追加される

#### TC-027: 検索履歴の取得
- **目的**: 保存された検索履歴の取得
- **入力**: getSearchHistory()
- **期待結果**: 
  - 履歴リストが返される
  - 最新順に並ぶ

#### TC-028: 検索履歴の削除
- **目的**: 検索履歴のクリア
- **入力**: clearSearchHistory()
- **期待結果**: 
  - 履歴が空になる

### 9. 統計情報テスト

#### TC-029: 基本統計の取得
- **目的**: 期間の統計情報取得
- **入力**: getStatistics()
- **期待結果**: 
  - 総記録数、総距離、総時間が返される
  - 平均値も含まれる

#### TC-030: 期間指定統計
- **目的**: 特定期間の統計
- **入力**: getStatistics({ startDate: '2024-01-01', endDate: '2024-01-31' })
- **期待結果**: 
  - 指定期間のみの統計が返される

### 10. 性能テスト

#### TC-031: 大量データ表示
- **目的**: 1000件データの表示性能
- **入力**: 1000件のモックデータで一覧表示
- **期待結果**: 
  - 2秒以内に表示完了
  - UIがブロックされない

#### TC-032: 検索性能
- **目的**: 大量データでの検索速度
- **入力**: 1000件データでの検索
- **期待結果**: 
  - 500ms以内に結果表示

#### TC-033: スクロール性能
- **目的**: 仮想スクロールの滑らかさ
- **入力**: 連続的なスクロール操作
- **期待結果**: 
  - 60fps を維持
  - メモリ使用量が一定

### 11. エラーハンドリングテスト

#### TC-034: ストレージエラー
- **目的**: データ取得失敗時の処理
- **入力**: ストレージエラー状態での一覧取得
- **期待結果**: 
  - 適切なエラーメッセージ
  - アプリがクラッシュしない

#### TC-035: ネットワークエラー
- **目的**: オフライン時の処理
- **入力**: ネットワーク切断状態での操作
- **期待結果**: 
  - キャッシュデータの表示
  - 同期待ちの表示

### 12. UI/UX テスト

#### TC-036: モバイル操作性
- **目的**: タッチデバイスでの操作確認
- **入力**: スマートフォンでの各種操作
- **期待結果**: 
  - タッチターゲットが適切
  - スクロールが滑らか

#### TC-037: レスポンシブ対応
- **目的**: 画面サイズ対応の確認
- **入力**: 異なる画面サイズでの表示
- **期待結果**: 
  - レイアウトが適切に調整される

## モックデータ

```typescript
// 大量テストデータ
const mockHistoryData = Array.from({ length: 1000 }, (_, i) => ({
  id: `history-${i}`,
  date: new Date(Date.now() - i * 24 * 60 * 60 * 1000),
  startLocation: { name: `出発地${i % 10}`, latitude: 35.6762, longitude: 139.6503 },
  endLocation: { name: `到着地${i % 10}`, latitude: 35.6897, longitude: 139.6922 },
  waypoints: [],
  totalDistance: Math.random() * 100,
  duration: Math.random() * 480,
  status: ['IN_PROGRESS', 'COMPLETED', 'CANCELLED'][i % 3],
  purpose: ['営業', '通勤', 'プライベート'][i % 3],
  memo: `テストメモ${i}`
}));

// フィルタテスト用データ
const mockFilterData = [
  { date: '2024-01-15', status: 'COMPLETED', distance: 25.5, duration: 120 },
  { date: '2024-01-16', status: 'IN_PROGRESS', distance: 45.0, duration: 180 },
  { date: '2024-01-17', status: 'CANCELLED', distance: 15.2, duration: 90 }
];

// 検索テスト用データ
const mockSearchData = [
  { name: '東京駅', memo: '新幹線での出張' },
  { name: '新宿駅', memo: '会議参加のため' },
  { name: '渋谷駅', memo: 'プライベートな用事' }
];
```

## テスト優先順位

1. **必須テスト**（P1）
   - TC-001, TC-004, TC-009, TC-015, TC-019, TC-031

2. **重要テスト**（P2）
   - TC-006, TC-014, TC-022, TC-029, TC-032, TC-036

3. **補完テスト**（P3）
   - その他のテストケース