# TASK-501: メイン画面（ダッシュボード）実装 - 要件定義

## 概要

運転日報PWAのメイン画面（ダッシュボード）を実装する。ユーザーが最初にアクセスする画面として、運転記録の開始、最近の記録一覧、ナビゲーション機能を提供する。

## 機能要件

### 1. ダッシュボード基本機能

#### 1.1 新規記録開始セクション
- **機能**: 新しい運転記録を開始するメイン機能
- **UI要素**:
  - 大きな「記録開始」ボタン（44x44px以上）
  - 現在の日時表示
  - GPS状態インジケーター
- **インタラクション**:
  - ワンタップで運転記録開始
  - GPS取得状態の可視化
  - 記録中の場合は「記録中」状態を表示

#### 1.2 最近の記録一覧
- **機能**: 最近の運転記録のクイックアクセス
- **表示項目**:
  - 日付・時刻
  - 出発地・到着地
  - 距離・時間
  - 記録状態（完了/進行中/キャンセル）
- **制限**: 最大5件まで表示

#### 1.3 統計サマリー
- **機能**: 運転記録の基本統計を表示
- **表示項目**:
  - 今日の走行距離
  - 今週の走行距離
  - 今月の走行距離
  - 総記録数

#### 1.4 ナビゲーション
- **機能**: 他画面への遷移
- **ナビゲーション要素**:
  - 履歴画面への遷移
  - 設定画面への遷移
  - エクスポート機能への遷移

### 2. 状態管理機能

#### 2.1 記録状態の監視
- **機能**: 進行中の記録状態を監視・表示
- **要件**:
  - 記録中の場合、記録開始ボタンを「記録中」に変更
  - 進行時間のリアルタイム表示
  - 記録停止・一時停止機能へのアクセス

#### 2.2 データの自動更新
- **機能**: 最新データの自動反映
- **要件**:
  - 画面フォーカス時の自動更新
  - 定期的なデータ更新（5分間隔）
  - 新規記録完了時の即座更新

### 3. エラーハンドリング

#### 3.1 GPS関連エラー
- **GPS利用不可**: 適切な説明と代替手段の提示
- **GPS権限拒否**: 権限要求の再試行オプション
- **GPS精度低下**: 警告表示と待機オプション

#### 3.2 データ関連エラー
- **データ読み込み失敗**: 再試行ボタンの提供
- **ネットワークエラー**: オフライン対応の説明
- **ストレージエラー**: 容量確認と対処法の提示

## 非機能要件

### 1. パフォーマンス要件

#### 1.1 レスポンス時間
- **初期表示**: 2秒以内
- **データ更新**: 1秒以内
- **画面遷移**: 0.5秒以内

#### 1.2 メモリ使用量
- **ベースメモリ**: 50MB以下
- **データキャッシュ**: 最大20MB
- **画像リソース**: 最大10MB

### 2. ユーザビリティ要件

#### 2.1 モバイル最適化
- **タップ領域**: 44x44px以上
- **片手操作**: 親指で届く範囲にメイン機能配置
- **画面サイズ**: 320px〜480px幅に対応

#### 2.2 視認性
- **コントラスト**: WCAG AA準拠
- **フォントサイズ**: 最小16px
- **色覚対応**: 色以外の情報伝達手段併用

#### 2.3 操作性
- **直感的UI**: 初回使用でも迷わない設計
- **フィードバック**: 操作に対する適切な反応
- **エラー回復**: 簡単な修正・再試行手順

### 3. アクセシビリティ要件

#### 3.1 WCAG 2.1 AA準拠
- **セマンティックHTML**: 適切な要素使用
- **ARIA属性**: スクリーンリーダー対応
- **キーボードナビゲーション**: 全機能対応
- **フォーカス管理**: 明確なフォーカス表示

#### 3.2 支援技術対応
- **スクリーンリーダー**: 音声読み上げ対応
- **音声制御**: 基本的な音声コマンド対応
- **ハイコントラストモード**: システム設定連動

### 4. レスポンシブデザイン要件

#### 4.1 ブレークポイント
- **スマートフォン**: 320px - 480px
- **タブレット**: 481px - 768px
- **デスクトップ**: 769px以上

#### 4.2 レイアウト調整
- **縦画面**: シングルカラムレイアウト
- **横画面**: 2カラムレイアウト（タブレット以上）
- **可変幅**: 親要素に応じた適応

## API設計

### 1. Component Interface

```typescript
interface DashboardProps {
  className?: string;
  onRecordStart?: () => void;
  onNavigate?: (route: string) => void;
}

interface DashboardState {
  isLoading: boolean;
  recentLogs: DrivingLog[];
  statistics: DashboardStatistics;
  currentRecording?: DrivingLog;
  errors: DashboardError[];
}

interface DashboardStatistics {
  todayDistance: number;
  weekDistance: number;
  monthDistance: number;
  totalRecords: number;
}

interface DashboardError {
  type: 'GPS' | 'DATA' | 'NETWORK' | 'STORAGE';
  message: string;
  recoverable: boolean;
  action?: () => void;
}
```

### 2. Hook Interface

```typescript
interface UseDashboard {
  state: DashboardState;
  actions: {
    startRecording: () => Promise<void>;
    refreshData: () => Promise<void>;
    dismissError: (index: number) => void;
    retryAction: (errorIndex: number) => Promise<void>;
  };
}
```

### 3. Service Integration

```typescript
interface DashboardService {
  // データ取得
  getRecentLogs(): Promise<DrivingLog[]>;
  getStatistics(): Promise<DashboardStatistics>;
  getCurrentRecording(): Promise<DrivingLog | null>;
  
  // 記録制御
  startNewRecording(): Promise<DrivingLog>;
  
  // 状態監視
  onRecordingStateChange(callback: (log?: DrivingLog) => void): void;
  onDataUpdate(callback: () => void): void;
}
```

## UI設計

### 1. コンポーネント構造

```
Dashboard
├── DashboardHeader
│   ├── Logo
│   ├── NotificationBadge
│   └── MenuButton
├── RecordingSection
│   ├── StartRecordButton
│   ├── CurrentStatus
│   └── GPSIndicator
├── RecentLogsSection
│   ├── SectionHeader
│   └── LogList
│       └── LogItem[]
├── StatisticsSection
│   ├── StatCard (Today)
│   ├── StatCard (Week)
│   ├── StatCard (Month)
│   └── StatCard (Total)
└── NavigationSection
    ├── HistoryButton
    ├── SettingsButton
    └── ExportButton
```

### 2. レイアウト仕様

#### 2.1 スマートフォン（縦画面）
```
┌─────────────────────┐
│ Header              │ 60px
├─────────────────────┤
│ Recording Section   │ 120px
├─────────────────────┤
│ Statistics          │ 100px
├─────────────────────┤
│ Recent Logs         │ 200px
├─────────────────────┤
│ Navigation          │ 80px
└─────────────────────┘
```

#### 2.2 タブレット（横画面）
```
┌─────────────┬───────────────┐
│ Recording   │ Statistics    │
│ Section     │ Section       │
├─────────────┼───────────────┤
│ Recent Logs │ Navigation    │
│ Section     │ Section       │
└─────────────┴───────────────┘
```

### 3. スタイリング仕様

#### 3.1 カラーパレット
- **プライマリー**: #2196F3 (Blue)
- **セカンダリー**: #4CAF50 (Green)
- **警告**: #FF9800 (Orange)
- **エラー**: #F44336 (Red)
- **テキスト**: #212121 (Dark Gray)
- **背景**: #FAFAFA (Light Gray)

#### 3.2 タイポグラフィ
- **見出し**: 24px, Bold, #212121
- **サブ見出し**: 18px, Medium, #424242
- **本文**: 16px, Regular, #616161
- **キャプション**: 14px, Regular, #757575
- **ボタン**: 16px, Medium, White

#### 3.3 コンポーネントスタイル
- **角丸**: 8px
- **影**: box-shadow: 0 2px 4px rgba(0,0,0,0.1)
- **パディング**: 16px (標準), 8px (コンパクト)
- **マージン**: 16px (セクション間), 8px (要素間)

## テスト要件

### 1. ユニットテスト

#### 1.1 コンポーネントテスト
- **レンダリング**: 正常な初期表示
- **プロパティ**: props の正しい受け渡し
- **イベント**: ユーザー操作への反応
- **状態管理**: 内部状態の適切な更新

#### 1.2 フックテスト
- **データ取得**: API呼び出しと結果処理
- **エラーハンドリング**: 異常系の適切な処理
- **状態更新**: 状態変更の正確性
- **副作用**: useEffectの適切な動作

### 2. 統合テスト

#### 2.1 コンポーネント間連携
- **データフロー**: 親子間のデータ受け渡し
- **イベント伝播**: イベントの適切な伝達
- **状態同期**: 複数コンポーネント間の状態一致

#### 2.2 Service連携
- **API呼び出し**: 正しいサービス利用
- **データ変換**: レスポンスの適切な変換
- **エラー処理**: サービスエラーの適切な処理

### 3. E2Eテスト

#### 3.1 ユーザーフロー
- **初回アクセス**: 新規ユーザーの体験
- **記録開始**: 運転記録開始の一連の流れ
- **データ確認**: 記録完了後のデータ表示
- **エラー回復**: エラー発生時の復旧手順

#### 3.2 レスポンシブテスト
- **画面サイズ**: 各ブレークポイントでの表示
- **操作性**: タッチ・マウス操作の確認
- **パフォーマンス**: 各デバイスでの動作速度

### 4. アクセシビリティテスト

#### 4.1 スクリーンリーダーテスト
- **音声読み上げ**: 適切な情報の音声化
- **ナビゲーション**: キーボードでの画面遷移
- **フォーカス管理**: 論理的なフォーカス移動

#### 4.2 コントラストテスト
- **色彩**: 十分なコントラスト比の確認
- **視認性**: 各要素の明確な区別
- **ハイコントラスト**: システム設定との連動

## 実装優先順位

### Phase 1: 基本構造（必須）
1. Dashboard コンポーネントの基本構造
2. RecordingSection の実装
3. 基本的なレスポンシブレイアウト
4. 基本的なアクセシビリティ対応

### Phase 2: データ連携（重要）
1. useDashboard フックの実装
2. RecentLogsSection の実装
3. StatisticsSection の実装
4. データ更新機能

### Phase 3: 高度な機能（推奨）
1. リアルタイム更新
2. 詳細なエラーハンドリング
3. パフォーマンス最適化
4. 高度なアクセシビリティ対応

## 成功基準

### 機能面
- ✅ 運転記録開始が1タップで実行できる
- ✅ 最近の記録が正確に表示される
- ✅ 統計情報が正しく計算・表示される
- ✅ エラー時に適切な対応ができる

### 品質面
- ✅ テストカバレッジ 90% 以上
- ✅ WCAG 2.1 AA準拠
- ✅ 全ブレークポイントでの正常動作
- ✅ パフォーマンス要件の満足

### ユーザー体験面
- ✅ 直感的で使いやすいインターフェース
- ✅ スムーズな操作感
- ✅ 適切なフィードバック
- ✅ 信頼性の高い動作

## 実装時の注意事項

### 1. 既存コードとの統合
- 既存のコントローラー（DrivingLogController等）を活用
- 型定義の一貫性を保つ
- 既存のスタイルガイドに従う

### 2. パフォーマンス考慮
- 不要な再レンダリングを避ける
- メモリリークを防ぐ
- 画像の最適化

### 3. 保守性
- コンポーネントの再利用性を高める
- テストしやすい設計
- ドキュメントの充実

### 4. セキュリティ
- XSS対策の実装
- 入力値の検証
- 機密情報の適切な取り扱い