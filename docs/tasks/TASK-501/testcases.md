# TASK-501: メイン画面（ダッシュボード）実装 - テストケース設計

## テストケース一覧

### 1. Dashboard コンポーネント基本テスト

#### TC-001: 基本レンダリング
- **目的**: ダッシュボードの基本構造が正しく表示される
- **前提条件**: コンポーネントが正常にマウントされる
- **テスト手順**:
  1. Dashboard コンポーネントをレンダリング
  2. 各セクションの存在確認
- **期待結果**:
  - RecordingSection が表示される
  - RecentLogsSection が表示される
  - StatisticsSection が表示される
  - NavigationSection が表示される

#### TC-002: プロパティ受け渡し
- **目的**: props が正しく子コンポーネントに渡される
- **入力**: `{ className: 'custom-class', onRecordStart: mockFunction }`
- **期待結果**:
  - カスタムクラスが適用される
  - コールバック関数が適切に設定される

#### TC-003: 初期状態の確認
- **目的**: 初期状態が正しく設定される
- **期待結果**:
  - isLoading が true から false に変わる
  - recentLogs が空配列で初期化される
  - statistics が初期値で設定される
  - errors が空配列で初期化される

### 2. RecordingSection テスト

#### TC-004: 記録開始ボタン表示
- **目的**: 記録開始ボタンが正しく表示される
- **前提条件**: 記録中ではない状態
- **期待結果**:
  - 「記録開始」ボタンが表示される
  - ボタンサイズが44x44px以上
  - タップ可能な状態

#### TC-005: 記録中状態の表示
- **目的**: 記録中の状態が正しく表示される
- **前提条件**: `currentRecording` が存在する
- **期待結果**:
  - 「記録中」状態が表示される
  - 経過時間が表示される
  - 停止ボタンが表示される

#### TC-006: GPS状態インジケーター
- **目的**: GPS状態が正しく表示される
- **テストデータ**:
  - GPS利用可能: 緑色インジケーター
  - GPS取得中: 黄色インジケーター
  - GPS利用不可: 赤色インジケーター
- **期待結果**: 各状態に対応した色とアイコンが表示される

#### TC-007: 記録開始アクション
- **目的**: 記録開始ボタンクリック時の動作確認
- **テスト手順**:
  1. 記録開始ボタンをクリック
  2. onRecordStart コールバックの呼び出し確認
- **期待結果**: コールバック関数が1回呼び出される

### 3. RecentLogsSection テスト

#### TC-008: 最近の記録一覧表示
- **目的**: 最近の記録が正しく表示される
- **テストデータ**: 5件の記録データ
- **期待結果**:
  - 最大5件までの記録が表示される
  - 日付・時刻が正しく表示される
  - 出発地・到着地が表示される
  - 距離・時間が表示される

#### TC-009: 空の記録一覧
- **目的**: 記録がない場合の表示確認
- **前提条件**: recentLogs が空配列
- **期待結果**:
  - 「記録がありません」メッセージが表示される
  - 記録開始を促すCTAが表示される

#### TC-010: 記録項目クリック
- **目的**: 記録項目クリック時の詳細表示
- **テスト手順**:
  1. 記録項目をクリック
  2. 詳細画面への遷移確認
- **期待結果**: 詳細画面が表示される

#### TC-011: 記録状態の表示
- **目的**: 各記録の状態が正しく表示される
- **テストデータ**:
  - COMPLETED: 完了マーク
  - IN_PROGRESS: 進行中マーク
  - CANCELLED: キャンセルマーク
- **期待結果**: 各状態に対応したアイコンが表示される

### 4. StatisticsSection テスト

#### TC-012: 統計情報表示
- **目的**: 統計情報が正しく表示される
- **テストデータ**:
  ```typescript
  {
    todayDistance: 25.5,
    weekDistance: 120.3,
    monthDistance: 450.8,
    totalRecords: 42
  }
  ```
- **期待結果**:
  - 今日の走行距離: 25.5km
  - 今週の走行距離: 120.3km
  - 今月の走行距離: 450.8km
  - 総記録数: 42件

#### TC-013: 数値フォーマット
- **目的**: 数値が適切にフォーマットされる
- **テストデータ**: 小数点以下の値を含む距離
- **期待結果**:
  - 距離は小数点以下1桁まで表示
  - 単位（km、件）が適切に表示
  - 3桁区切りカンマが表示される（必要に応じて）

#### TC-014: 統計カードのレスポンシブ表示
- **目的**: 画面サイズに応じたレイアウト調整
- **テストケース**:
  - スマートフォン: 2x2グリッド
  - タブレット: 1x4グリッド
- **期待結果**: 各サイズで適切なレイアウトが表示される

### 5. NavigationSection テスト

#### TC-015: ナビゲーションボタン表示
- **目的**: ナビゲーションボタンが正しく表示される
- **期待結果**:
  - 履歴ボタンが表示される
  - 設定ボタンが表示される
  - エクスポートボタンが表示される

#### TC-016: ナビゲーションアクション
- **目的**: 各ボタンクリック時の動作確認
- **テスト手順**:
  1. 各ナビゲーションボタンをクリック
  2. onNavigate コールバックの呼び出し確認
- **期待結果**:
  - 履歴ボタン: '/history' で呼び出される
  - 設定ボタン: '/settings' で呼び出される
  - エクスポートボタン: '/export' で呼び出される

### 6. useDashboard フック テスト

#### TC-017: 初期化
- **目的**: フックの初期状態が正しく設定される
- **期待結果**:
  - isLoading が true で開始される
  - 空の配列・初期値が設定される
  - アクション関数が定義される

#### TC-018: データ取得
- **目的**: データ取得機能の確認
- **テスト手順**:
  1. フックをマウント
  2. データ取得の完了を待機
- **期待結果**:
  - isLoading が false になる
  - recentLogs にデータが設定される
  - statistics にデータが設定される

#### TC-019: 記録開始機能
- **目的**: startRecording アクションの確認
- **テスト手順**:
  1. startRecording() を呼び出し
  2. DrivingLogController.quickStart の呼び出し確認
- **期待結果**:
  - コントローラーが正しく呼び出される
  - 成功時に状態が更新される

#### TC-020: データ更新機能
- **目的**: refreshData アクションの確認
- **テスト手順**:
  1. refreshData() を呼び出し
  2. 最新データの取得確認
- **期待結果**: 全てのデータが最新に更新される

#### TC-021: エラー処理
- **目的**: エラー時の適切な処理確認
- **テストシナリオ**:
  - データ取得エラー
  - GPS権限拒否
  - ネットワークエラー
- **期待結果**: 各エラーに対応したメッセージが表示される

### 7. レスポンシブデザイン テスト

#### TC-022: スマートフォン表示（320px-480px）
- **目的**: スマートフォンでの適切な表示確認
- **テスト環境**: 320px、375px、480px幅
- **期待結果**:
  - シングルカラムレイアウト
  - タップ領域44px以上
  - 横スクロール無し

#### TC-023: タブレット表示（481px-768px）
- **目的**: タブレットでの適切な表示確認
- **テスト環境**: 600px、768px幅
- **期待結果**:
  - 2カラムレイアウト（横画面）
  - 適切な余白とスペーシング
  - 読みやすいフォントサイズ

#### TC-024: デスクトップ表示（769px以上）
- **目的**: デスクトップでの適切な表示確認
- **テスト環境**: 1024px、1920px幅
- **期待結果**:
  - 最大幅制限（1200px）
  - 中央配置
  - 適切な余白

#### TC-025: 画面回転対応
- **目的**: 縦横画面切り替え時の表示確認
- **テスト手順**:
  1. 縦画面で表示確認
  2. 横画面に回転
  3. レイアウト調整の確認
- **期待結果**: 回転時に適切にレイアウトが調整される

### 8. アクセシビリティ テスト

#### TC-026: セマンティックHTML
- **目的**: 適切なHTML要素の使用確認
- **確認項目**:
  - header要素の使用
  - main要素の使用
  - section要素の使用
  - button要素の使用
- **期待結果**: セマンティックな構造が実装される

#### TC-027: ARIA属性
- **目的**: 適切なARIA属性の設定確認
- **確認項目**:
  - aria-label の設定
  - aria-describedby の設定
  - role属性の設定
  - aria-live領域の設定
- **期待結果**: スクリーンリーダーで適切に読み上げられる

#### TC-028: キーボードナビゲーション
- **目的**: キーボードでの操作確認
- **テスト手順**:
  1. Tabキーでフォーカス移動
  2. Enterキーでボタン実行
  3. 矢印キーでリスト移動
- **期待結果**: 全機能がキーボードで操作可能

#### TC-029: フォーカス管理
- **目的**: フォーカスの適切な管理確認
- **確認項目**:
  - 初期フォーカス位置
  - フォーカス移動順序
  - フォーカス表示の明確性
- **期待結果**: 論理的なフォーカス移動が実現される

#### TC-030: カラーコントラスト
- **目的**: 十分なコントラスト比の確認
- **確認項目**:
  - 通常テキスト: 4.5:1以上
  - 大きなテキスト: 3:1以上
  - ボタン・アイコン: 3:1以上
- **期待結果**: WCAG AA基準を満たす

### 9. パフォーマンス テスト

#### TC-031: 初期レンダリング性能
- **目的**: 初期表示時間の確認
- **測定項目**:
  - First Contentful Paint (FCP)
  - Largest Contentful Paint (LCP)
  - Time to Interactive (TTI)
- **期待結果**:
  - FCP: 1.8秒以下
  - LCP: 2.5秒以下
  - TTI: 3.8秒以下

#### TC-032: データ更新性能
- **目的**: データ更新時の性能確認
- **測定項目**:
  - 更新処理時間
  - メモリ使用量
  - 不要な再レンダリング
- **期待結果**:
  - 更新時間: 1秒以下
  - メモリリーク無し
  - 最適化された再レンダリング

#### TC-033: スクロール性能
- **目的**: スクロール時の滑らかさ確認
- **測定項目**: FPS (Frames Per Second)
- **期待結果**: 60FPS以上の滑らかなスクロール

### 10. エラーハンドリング テスト

#### TC-034: GPS権限エラー
- **目的**: GPS権限拒否時の処理確認
- **シミュレーション**: navigator.geolocation = undefined
- **期待結果**:
  - 適切なエラーメッセージ表示
  - 代替手段の提示
  - 再試行オプションの提供

#### TC-035: データ取得エラー
- **目的**: API呼び出し失敗時の処理確認
- **シミュレーション**: サービス関数のエラー投げ
- **期待結果**:
  - エラーメッセージの表示
  - 再試行ボタンの表示
  - 部分的な機能継続

#### TC-036: ネットワークエラー
- **目的**: オフライン時の処理確認
- **シミュレーション**: navigator.onLine = false
- **期待結果**:
  - オフライン状態の表示
  - キャッシュデータの利用
  - 再接続時の自動復旧

#### TC-037: ストレージエラー
- **目的**: ストレージ満杯時の処理確認
- **シミュレーション**: QuotaExceededError の発生
- **期待結果**:
  - 容量不足の警告表示
  - データクリーンアップの提案
  - 緊急時機能の継続

### 11. 統合テスト

#### TC-038: エンドツーエンドフロー
- **目的**: 一連の操作フローの確認
- **テスト手順**:
  1. ダッシュボードアクセス
  2. 記録開始ボタンクリック
  3. 記録完了
  4. ダッシュボード更新確認
- **期待結果**: 全フローが正常に完了する

#### TC-039: 複数画面遷移
- **目的**: 画面間の連携確認
- **テスト手順**:
  1. ダッシュボード表示
  2. 履歴画面に遷移
  3. ダッシュボードに戻る
  4. データの整合性確認
- **期待結果**: 状態が正しく保持される

#### TC-040: リアルタイム更新
- **目的**: データ変更時の自動更新確認
- **テスト手順**:
  1. 複数タブでダッシュボード表示
  2. 一方で記録作成
  3. 他方での自動更新確認
- **期待結果**: 自動的にデータが更新される

### 12. ブラウザ互換性テスト

#### TC-041: Chrome での動作確認
- **対象バージョン**: 最新版、1つ前のバージョン
- **確認項目**: 全機能の正常動作
- **期待結果**: 全機能が期待通りに動作する

#### TC-042: Firefox での動作確認
- **対象バージョン**: 最新版、ESR版
- **確認項目**: CSS Grid、Flexboxの表示確認
- **期待結果**: レイアウトが正しく表示される

#### TC-043: Safari での動作確認
- **対象バージョン**: 最新版（iOS/macOS）
- **確認項目**: WebKit固有の制限確認
- **期待結果**: 基本機能が正常動作する

#### TC-044: Edge での動作確認
- **対象バージョン**: Chromium版Edge
- **確認項目**: レガシー環境での動作確認
- **期待結果**: 互換性問題が発生しない

## モックデータ

### 基本テストデータ
```typescript
const mockRecentLogs: DrivingLog[] = [
  {
    id: 'log-001',
    date: new Date('2024-08-15'),
    startTime: new Date('2024-08-15T09:00:00'),
    endTime: new Date('2024-08-15T10:30:00'),
    startLocation: {
      id: 'loc-001',
      name: '東京駅',
      latitude: 35.6812,
      longitude: 139.7671,
      type: LocationType.START,
      timestamp: new Date('2024-08-15T09:00:00')
    },
    endLocation: {
      id: 'loc-002',
      name: '新宿駅',
      latitude: 35.6896,
      longitude: 139.7006,
      type: LocationType.END,
      timestamp: new Date('2024-08-15T10:30:00')
    },
    totalDistance: 15.2,
    duration: 90,
    status: DrivingLogStatus.COMPLETED,
    createdAt: new Date('2024-08-15T09:00:00'),
    updatedAt: new Date('2024-08-15T10:30:00')
  }
];

const mockStatistics: DashboardStatistics = {
  todayDistance: 25.5,
  weekDistance: 120.3,
  monthDistance: 450.8,
  totalRecords: 42
};

const mockCurrentRecording: DrivingLog = {
  id: 'log-current',
  date: new Date(),
  startTime: new Date(),
  startLocation: {
    id: 'loc-current',
    name: '現在地',
    latitude: 35.6812,
    longitude: 139.7671,
    type: LocationType.START,
    timestamp: new Date()
  },
  status: DrivingLogStatus.IN_PROGRESS,
  createdAt: new Date(),
  updatedAt: new Date()
};
```

### エラーシナリオデータ
```typescript
const mockErrors: DashboardError[] = [
  {
    type: 'GPS',
    message: 'GPS信号を取得できません',
    recoverable: true,
    action: () => console.log('GPS再試行')
  },
  {
    type: 'DATA',
    message: 'データの読み込みに失敗しました',
    recoverable: true,
    action: () => console.log('データ再読み込み')
  },
  {
    type: 'NETWORK',
    message: 'ネットワークに接続できません',
    recoverable: false
  }
];
```

## テスト実行計画

### Phase 1: ユニットテスト（2-3日）
- コンポーネント単体テスト（TC-001 ～ TC-021）
- フック単体テスト
- 基本的なレスポンシブテスト

### Phase 2: 統合テスト（1-2日）
- コンポーネント間連携テスト（TC-038 ～ TC-040）
- Service 連携テスト
- エラーハンドリングテスト（TC-034 ～ TC-037）

### Phase 3: E2E・性能テスト（1日）
- アクセシビリティテスト（TC-026 ～ TC-030）
- パフォーマンステスト（TC-031 ～ TC-033）
- ブラウザ互換性テスト（TC-041 ～ TC-044）

## 成功基準

### テストカバレッジ
- **ユニットテスト**: 90%以上
- **統合テスト**: 主要フロー100%カバー
- **E2Eテスト**: クリティカルパス100%カバー

### パフォーマンス
- **初期表示**: 2秒以内
- **データ更新**: 1秒以内
- **FPS**: 60fps以上

### アクセシビリティ
- **WCAG 2.1 AA**: 100%準拠
- **キーボード操作**: 全機能対応
- **スクリーンリーダー**: 完全対応

### 品質
- **全テストケース**: PASS
- **ブラウザ互換性**: 主要ブラウザ対応
- **レスポンシブ**: 全ブレークポイント対応