# TASK-202: 位置情報コントローラー実装 - テストケース設計

## テストケース一覧

### 1. GPS地点記録テスト

#### TC-001: GPS位置情報の正常記録
- **目的**: GPSから現在地点を正常に記録できることを確認
- **入力**: recordCurrentLocation()
- **期待結果**: 
  - LocationModelが返される
  - GPS座標が正しく設定される
  - タイムスタンプが現在時刻
  - LocationType.GPSが設定される

#### TC-002: 地点名の自動生成
- **目的**: autoNameオプションで地点名が自動生成されることを確認
- **入力**: recordCurrentLocation({ autoName: true })
- **期待結果**: 
  - 日時ベースの地点名が生成される
  - フォーマット: "2024-01-15 14:30 地点"

#### TC-003: カスタム地点名の設定
- **目的**: 手動で地点名を設定できることを確認
- **入力**: recordCurrentLocation({ name: "顧客A訪問", type: LocationType.WAYPOINT })
- **期待結果**: 
  - 指定した地点名が設定される
  - 指定したタイプが設定される

#### TC-004: GPS取得失敗時のエラー処理
- **目的**: GPS取得失敗時の適切なエラーハンドリング
- **入力**: GPS利用不可状態でrecordCurrentLocation()
- **期待結果**: 
  - エラーがスローされる
  - エラーメッセージが明確
  - 手動入力を促すメッセージ

### 2. 手動入力テスト

#### TC-005: 住所からの地点記録
- **目的**: 住所入力から地点を記録できることを確認
- **入力**: recordManualLocation({ name: "東京駅", address: "東京都千代田区丸の内1-9-1", type: LocationType.DEPARTURE })
- **期待結果**: 
  - LocationModelが作成される
  - 住所が保存される
  - LocationType.MANUALが設定される

#### TC-006: 緯度経度の直接入力
- **目的**: 座標を直接入力して地点を記録
- **入力**: recordManualLocation({ name: "テスト地点", latitude: 35.6762, longitude: 139.6503, type: LocationType.ARRIVAL })
- **期待結果**: 
  - 指定した座標が設定される
  - バリデーション成功

#### TC-007: 入力値バリデーション - 無効な緯度
- **目的**: 無効な緯度でエラーになることを確認
- **入力**: recordManualLocation({ name: "テスト", latitude: 91, longitude: 139, type: LocationType.WAYPOINT })
- **期待結果**: 
  - バリデーションエラー
  - エラーメッセージ: "緯度は-90〜90の範囲で入力してください"

#### TC-008: 入力値バリデーション - 無効な経度
- **目的**: 無効な経度でエラーになることを確認
- **入力**: recordManualLocation({ name: "テスト", latitude: 35, longitude: 181, type: LocationType.WAYPOINT })
- **期待結果**: 
  - バリデーションエラー
  - エラーメッセージ: "経度は-180〜180の範囲で入力してください"

#### TC-009: 必須項目の欠落
- **目的**: 必須項目が欠落している場合のエラー
- **入力**: recordManualLocation({ type: LocationType.DEPARTURE })
- **期待結果**: 
  - バリデーションエラー
  - エラーメッセージ: "地点名は必須です"

### 3. よく使う地点管理テスト

#### TC-010: よく使う地点の追加
- **目的**: 地点をお気に入りに追加できることを確認
- **入力**: addFavoriteLocation(location, "自宅")
- **期待結果**: 
  - よく使う地点リストに追加される
  - カテゴリが設定される
  - 使用回数が0で初期化

#### TC-011: よく使う地点の取得
- **目的**: 登録済みのよく使う地点を取得
- **入力**: getFavoriteLocations()
- **期待結果**: 
  - 登録済み地点のリストが返される
  - 使用頻度順にソートされている

#### TC-012: カテゴリ別取得
- **目的**: 特定カテゴリの地点のみ取得
- **入力**: getFavoriteLocations("会社")
- **期待結果**: 
  - 指定カテゴリの地点のみ返される

#### TC-013: よく使う地点の削除
- **目的**: よく使う地点を削除できることを確認
- **入力**: removeFavoriteLocation(locationId)
- **期待結果**: 
  - 指定地点がリストから削除される
  - ストレージからも削除される

#### TC-014: デフォルト地点の設定
- **目的**: デフォルト地点を設定できることを確認
- **入力**: 地点をデフォルトに設定
- **期待結果**: 
  - isDefaultフラグがtrueになる
  - 他のデフォルト地点はfalseになる

### 4. 検索・フィルタリングテスト

#### TC-015: 地点名での検索
- **目的**: 地点名で位置情報を検索できることを確認
- **入力**: searchLocations({ query: "顧客" })
- **期待結果**: 
  - "顧客"を含む地点が返される
  - 部分一致で検索される

#### TC-016: 日付範囲でのフィルタリング
- **目的**: 指定期間の位置情報を取得
- **入力**: searchLocations({ startDate: new Date('2024-01-01'), endDate: new Date('2024-01-31') })
- **期待結果**: 
  - 指定期間内の地点のみ返される

#### TC-017: 地点種類でのフィルタリング
- **目的**: 特定の地点種類のみ取得
- **入力**: searchLocations({ type: LocationType.DEPARTURE })
- **期待結果**: 
  - 出発地点のみ返される

#### TC-018: 複合条件での検索
- **目的**: 複数条件を組み合わせた検索
- **入力**: searchLocations({ query: "東京", type: LocationType.ARRIVAL, favoriteOnly: true })
- **期待結果**: 
  - すべての条件を満たす地点が返される

#### TC-019: ソート機能
- **目的**: 結果を指定順でソート
- **入力**: searchLocations({ sortBy: 'date', sortOrder: 'desc' })
- **期待結果**: 
  - 日付の降順でソートされる

### 5. 最近の位置情報取得テスト

#### TC-020: 最近の位置情報取得
- **目的**: 直近の位置情報を取得
- **入力**: getRecentLocations(10)
- **期待結果**: 
  - 最新10件の位置情報が返される
  - 新しい順にソートされている

#### TC-021: デフォルト件数での取得
- **目的**: 件数未指定時のデフォルト動作
- **入力**: getRecentLocations()
- **期待結果**: 
  - デフォルト20件が返される

### 6. 位置情報の更新・削除テスト

#### TC-022: 位置情報の更新
- **目的**: 既存の位置情報を更新
- **入力**: updateLocation(locationId, { name: "新しい名前", memo: "メモ追加" })
- **期待結果**: 
  - 指定フィールドが更新される
  - 他のフィールドは保持される

#### TC-023: 位置情報の削除
- **目的**: 位置情報を削除
- **入力**: deleteLocation(locationId)
- **期待結果**: 
  - 指定地点が削除される
  - ストレージからも削除される

#### TC-024: 存在しないIDでの更新・削除
- **目的**: 無効なIDでのエラーハンドリング
- **入力**: updateLocation("invalid-id", {})
- **期待結果**: 
  - エラーがスローされる
  - エラーメッセージ: "指定された位置情報が見つかりません"

### 7. GPS利用可能性テスト

#### TC-025: GPS利用可能性チェック
- **目的**: GPS利用可能性を正しく判定
- **入力**: isGPSAvailable()
- **期待結果**: 
  - GPS利用可能時: true
  - GPS利用不可時: false

### 8. データ永続化テスト

#### TC-026: データの保存と復元
- **目的**: データが永続化されることを確認
- **入力**: 地点記録後、コントローラー再初期化
- **期待結果**: 
  - 記録した地点が復元される
  - よく使う地点も復元される

#### TC-027: ストレージエラー時の処理
- **目的**: ストレージエラー時の復旧処理
- **入力**: ストレージ容量不足状態での記録
- **期待結果**: 
  - エラーメッセージが表示される
  - データの一部削除を提案

## モックデータ

```typescript
// テスト用モック位置情報
const mockLocation = {
  id: 'test-001',
  name: 'テスト地点',
  latitude: 35.6762,
  longitude: 139.6503,
  accuracy: 30,
  type: LocationType.WAYPOINT,
  timestamp: new Date('2024-01-15T10:00:00'),
  memo: 'テスト用メモ'
};

// テスト用よく使う地点
const mockFavorites = [
  { ...mockLocation, id: 'fav-001', name: '自宅', category: '個人' },
  { ...mockLocation, id: 'fav-002', name: '会社', category: '仕事' },
  { ...mockLocation, id: 'fav-003', name: '顧客A', category: '仕事' }
];
```

## テスト優先順位

1. **必須テスト**（P1）
   - TC-001, TC-005, TC-006, TC-010, TC-015, TC-022

2. **重要テスト**（P2）
   - TC-004, TC-007, TC-011, TC-016, TC-020, TC-026

3. **補完テスト**（P3）
   - TC-002, TC-003, TC-008, TC-009, TC-012-014, TC-017-019, TC-021, TC-023-025, TC-027