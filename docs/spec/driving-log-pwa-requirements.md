# 運転日報PWA 要件定義書

## 概要

運転日報を簡単に記録・管理できるPWA（Progressive Web App）。HTML、JavaScript、CSSのみで構築され、サーバーサイドの処理を一切必要とせず、完全にオフラインで動作する。ドライバーが出発・経由・到着の記録をGPS情報と共にブラウザのローカルストレージに保存し、運転履歴をCSV形式でエクスポートできるシステム。

## ユーザストーリー

### ストーリー1: 運転記録の作成

- **である** ドライバー **として**
- **私は** 出発地点・経由地点・到着地点を簡単に記録 **したい**
- **そうすることで** 正確な運転日報を作成できる

### ストーリー2: GPS位置情報の自動取得

- **である** ドライバー **として**
- **私は** 各地点の位置情報を自動的に記録 **したい**
- **そうすることで** 手動入力の手間を省き、正確な位置情報を残せる

### ストーリー3: 運転履歴の確認

- **である** ドライバー/管理者 **として**
- **私は** 過去の運転記録を簡単に確認 **したい**
- **そうすることで** 運転履歴を把握し、必要な情報を素早く見つけられる

### ストーリー4: データのエクスポート

- **である** 管理者 **として**
- **私は** 運転日報データをCSV形式でエクスポート **したい**
- **そうすることで** 外部システムでのデータ分析や報告書作成ができる

### ストーリー5: オフライン対応

- **である** ドライバー **として**
- **私は** インターネット接続がない場所でも記録を作成 **したい**
- **そうすることで** どこでも確実に運転記録を残せる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは、ユーザーが出発地点を記録できるようにしなければならない
- REQ-002: システムは、ユーザーが経由地点を複数記録できるようにしなければならない
- REQ-003: システムは、ユーザーが到着地点を記録できるようにしなければならない
- REQ-004: システムは、各地点の記録時にGPS位置情報（緯度・経度）を自動取得しなければならない
- REQ-005: システムは、各地点の記録時に日時を自動記録しなければならない
- REQ-006: システムは、記録された運転日報を一覧表示できなければならない
- REQ-007: システムは、運転日報をCSV形式でエクスポートできなければならない
- REQ-008: システムは、PWAとしてインストール可能でなければならない

### 条件付き要件

- REQ-101: GPS位置情報が取得できない場合、システムは手動で住所または地点名を入力できるようにしなければならない
- REQ-102: オフライン状態の場合、システムはデータをローカルストレージに保存しなければならない
- REQ-103: システムは、すべてのデータをブラウザのローカルストレージ（LocalStorage/IndexedDB）に保存しなければならない
- REQ-104: エクスポート時に日付範囲が指定された場合、システムは該当期間のデータのみをエクスポートしなければならない
- REQ-105: 運転中の場合、システムは簡易入力モード（ワンタップ記録）を提供しなければならない

### 状態要件

- REQ-201: オフライン状態にある場合、システムはオフラインインジケーターを表示しなければならない
- REQ-202: GPS取得中の状態にある場合、システムは取得中であることを視覚的に表示しなければならない
- REQ-203: データ保存中の状態にある場合、システムは保存の進行状況を表示しなければならない

### オプション要件

- REQ-301: システムは、よく使う地点を登録・選択できるようにしてもよい
- REQ-302: システムは、運転距離を自動計算して表示してもよい
- REQ-303: システムは、運転ルートを地図上に表示してもよい
- REQ-304: システムは、音声入力による地点名の記録を受け付けてもよい
- REQ-305: システムは、写真を各地点の記録に添付できるようにしてもよい

### 制約要件

- REQ-401: システムは、個人情報保護法に準拠してデータを取り扱わなければならない
- REQ-402: システムは、最新のWebブラウザ（Chrome、Safari、Firefox、Edge）で動作しなければならない
- REQ-403: システムは、スマートフォンおよびタブレットでの使用に最適化されていなければならない
- REQ-404: システムは、GPS情報へのアクセス許可をユーザーに明示的に求めなければならない
- REQ-405: システムは、HTML、JavaScript、CSSのみで実装され、サーバーサイドの処理を一切含んではならない
- REQ-406: システムは、Service Workerを使用して完全なオフライン動作を実現しなければならない
- REQ-407: システムは、すべてのデータをクライアントサイドのストレージに保存しなければならない

## 非機能要件

### パフォーマンス

- NFR-001: GPS位置情報の取得は5秒以内に完了しなければならない
- NFR-002: 運転日報の一覧表示は、1000件のデータがあっても2秒以内に表示されなければならない
- NFR-003: CSVエクスポートは、1ヶ月分のデータ（約3000件）でも10秒以内に完了しなければならない
- NFR-004: アプリケーションの初回起動は3秒以内に完了しなければならない

### セキュリティ

- NFR-101: システムは外部サーバーへのデータ送信を一切行ってはならない
- NFR-102: ローカルストレージのデータは適切に管理され、ユーザーの明示的な操作によってのみ削除可能でなければならない
- NFR-103: エクスポートされたCSVファイルには個人を特定できる情報を含めてはならない（ユーザーが明示的に選択した場合を除く）

### ユーザビリティ

- NFR-201: 運転中でも片手で操作できるUIデザインでなければならない
- NFR-202: 重要なボタンは最小でも44x44ピクセルのタップ領域を持たなければならない
- NFR-203: システムは日本語インターフェースを提供しなければならない
- NFR-204: エラーメッセージは具体的で分かりやすい日本語で表示されなければならない

### 信頼性

- NFR-301: システムは完全にオフラインで動作し、ネットワーク接続に依存してはならない
- NFR-302: データの保存は99.9%以上の成功率を達成しなければならない
- NFR-303: すべての機能がオフライン状態で使用可能でなければならない

## Edgeケース

### エラー処理

- EDGE-001: GPS権限が拒否された場合、手動入力フォームを表示し、権限の再要求方法を案内する
- EDGE-002: ローカルストレージが満杯の場合、古いデータの削除を提案するか、エクスポートを促す
- EDGE-003: ブラウザのファイルダウンロードAPIでCSVエクスポートが失敗した場合、代替方法（Blob URLやdata URL）を提供する
- EDGE-004: 不正なデータ形式が検出された場合、データの修復を試み、失敗時は該当データをスキップする

### 境界値

- EDGE-101: 1日に100件以上の地点記録がある場合でも正常に動作する
- EDGE-102: 地点名が100文字を超える場合、適切に切り詰めて表示する
- EDGE-103: GPS精度が50m以上の場合、低精度であることを警告表示する
- EDGE-104: 1年以上前の古いデータも正常に表示・エクスポートできる

### 異常系

- EDGE-201: 運転記録作成中にアプリがクラッシュした場合、次回起動時に未保存データを復元する
- EDGE-202: 日付が未来日時になっている場合、警告を表示して修正を促す
- EDGE-203: 緯度経度が日本国外の場合、確認ダイアログを表示する

## 受け入れ基準

### 機能テスト

- [ ] 出発地点をGPS情報と共に記録できる
- [ ] 複数の経由地点を順番に記録できる
- [ ] 到着地点を記録して運転日報を完了できる
- [ ] GPS取得不可時に手動で地点情報を入力できる
- [ ] 運転日報一覧から過去の記録を確認できる
- [ ] 指定期間の運転日報をCSV形式でダウンロードできる
- [ ] オフライン時にデータがローカルに保存される
- [ ] すべてのデータがブラウザのローカルストレージに確実に保存される
- [ ] PWAとしてホーム画面に追加できる

### 非機能テスト

- [ ] GPS取得が5秒以内に完了する
- [ ] 1000件のデータがある状態で一覧表示が2秒以内
- [ ] 運転中でも片手で主要操作が可能
- [ ] ネットワーク接続なしですべての機能が使用可能
- [ ] エラー発生時に適切な日本語メッセージが表示される
- [ ] 44x44ピクセル以上のタップ領域が確保されている
- [ ] スマートフォンの縦向き・横向きの両方で適切に表示される